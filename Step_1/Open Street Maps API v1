# Read the Excel file
file_path = 'C:/Your Folder/ev_stations_review.xlsx'
df = pd.read_excel(file_path, engine='openpyxl')

# Extract the coordinates
coordinates = df[['latitude', 'longitude']].values.tolist()

def query_osm_around_coordinates(latitude, longitude, radius):
    api = overpy.Overpass()
    overpass_query = f"""
    [out:json][timeout:25];
    (
      nwr["shop"](around:{radius},{latitude},{longitude});
      nwr["amenity"](around:{radius},{latitude},{longitude});
      nwr["leisure"](around:{radius},{latitude},{longitude});
    );
    out center;
    """
    result = api.query(overpass_query)
    return result

# Set the search radius in meters
radius = 1000

# Initialize an empty list to store the results
facilities = []

for lat, lon in coordinates:
    osm_data = query_osm_around_coordinates(lat, lon, radius)
    for node in osm_data.nodes:
        facility = {
            'charger_latitude': lat,
            'charger_longitude': lon,
            'name': node.tags.get('name'),
            'type': node.tags.get('amenity') or node.tags.get('shop') or node.tags.get('leisure'),
            'latitude': node.lat,
            'longitude': node.lon
        }
        facilities.append(facility)


# Create a DataFrame with the facilities
facilities_df = pd.DataFrame(facilities)

# Save the DataFrame to a new Excel file
facilities_df.to_excel('facilities_around_coordinates.xlsx', index=False)
